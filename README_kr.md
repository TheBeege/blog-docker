# 도커로 인프라 자동화하기

**읽어주세요**: 저는 전문가가 아닙니다. 사실 그 반대라고 할 수 있죠. 보통 제가 필요한 걸 할 수 있을 정도로만 배우고 넘어갑니다. 여기에 쓴 내용이 best practice라고 생각하지 말아주세요! 그저 기술로 할 수 있는 일들을 드러내기 위해서 썼을 뿐입니다. 저는 항상 공식문서나 튜토리얼을 읽어볼 것을 추천하는데요. 이상적으로는 필요하다면 번역을 해보는 것이 좋습니다.

오늘은 도커를 다뤄볼 건데요. 연습용 서비스를 만들어보고 도커를 사용해서 컨테이너화된, 소스로 제어하는 인프라를 돌리는 것을 자동화해볼 겁니다. 이게 무슨 뜻일까요?

먼저, 이전에 쓰던 다른 방식을 이야기해보겠습니다. 많은 분들이 가상 머신은 익숙하실 겁니다. OS를 자기 방식대로 설치하고, 그것의 이미지를 만들어서, 가상 머신을 호스트하는 하이퍼바이저를 사용한 다음, 여러분의 이미지들을 자유롭게 배포하는 것이죠. 오랫동안 이것은 물리적인 컴퓨팅 자원을 다양하게 사용하는 효율적인 방식이었습니다. 하지만 가상화에도 단점이 있습니다. 전체 운영체제에 꽤 많은 자원 오버헤드가 들게 되는데요. 부팅하는 시간이 괴로울 수 있습니다. 가상 디스크 이미지는 옮기거나 새로 만들기 어려울 정도로 크죠. (Vagrant를 통해서 완화되긴 했지만 이것도 최근에 개발되었습니다.) 이것도 돌아가긴 합니다. 오랫동안 그렇게 쓰였죠. 그렇지만 대안은 없는 걸까요?

도커에 입문해봅시다. 도커는 가상 머신 대신에 '컨테이너'라는 것을 사용합니다. 이건 격리되어 있으면서도 오버헤드를 줄인 운영환경을 만들기 위해 리눅스의 cgroup (또는 윈도우의 Hyper-V)을 활용합니다. 컨테이너의 오버헤드는 가상 머신보다 눈에 띄게 적고, 부팅도 무지 빠릅니다. 도커는 특히 컨테이너를 더 쉽고 편하게 사용할 수 있도록 많은 도구를 제공합니다. Vagrant와 비슷하게 컨테이너가 어떻게 설정되었는지 설명하는 Dockerfile이라는 텍스트 파일을 정의할 수도 있습니다. Dockerfile들을 읽고 도커 이미지를 만들거나, Dockerhub이나 Docker registry(git -> Github : Docker -> Dockerhub)에서 이미지를 올리거나 받고, 컨테이너를 관리할 수 있는 CLI 툴들도 있습니다. 그밖에 도커 컨테이너들을 조정(orchestrate)하는 툴들도 많습니다. '조정'이 무엇인지는 이 포스팅의 후반부에서 다루겠습니다.

좋습니다! 그럼 어떻게 시작하면 좋을까요? 여러분이 갖고있는 머신에 따라 다릅니다.

윈도우를 사용한다면 Hyper-V를 사용하기 때문에 윈도우 Professional이나 그 이상의 버전이 필요합니다. 저는 집에서 윈도우를 사용하기 때문에 도커를 돌리기 위해서 CentOS 가상 머신을 설치해야 했습니다. 윈도우를 위한 도커는 이곳을 확인하세요: https://docs.docker.com/docker-for-windows/install/

맥을 사용한다면 간단합니다. 맥을 위한 도커는 이곳을 확인하세요: https://docs.docker.com/docker-for-mac/install/

리눅스를 사용한다면 아래 링크에 CentOS를 위한 내용이 있습니다: https://docs.docker.com/engine/installation/linux/docker-ce/centos/
왼쪽 메뉴에 다른 distributions를 위한 링크들도 있습니다.

`도커` 서비스가 시작되었는지 다시 한번 확인해주세요!

이제 설치가 끝났기 때문에 한번 만들어봅시다. 컨테이너 하나에는 HTTP server와 함께 self-contained한 환경을, 다른 컨테이너에는 클라이언트를 만들고 이 모두를 실행하는 설정을 해보죠.
